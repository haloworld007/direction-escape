# 关卡生成与难度递增策略 (Level Design Strategy)

本文档详细阐述了从“随机模拟验证”转向“逆向填空生成”的重构方案，并重点定义了**难度递增（Difficulty Progression）**的核心策略。

## 1. 现状分析与痛点

目前的生成逻辑（`LevelGenerator.js`）采用“正向随机撒点 + 模拟验证”的方式。

### 核心问题
1.  **假阳性（False Positives）**：验证算法只能证明“存在解”，不能证明“人类可解”。往往生成“只有一种特定顺序能解，走错一步即死局”的关卡，玩家体验极差。
2.  **效率低下**：为了生成高难度（高死锁率）关卡，需要生成成百上千个废弃样本才能碰巧筛选出一个合格品。
3.  **难度失控**：目前主要靠“方块数量”来控制难度。但 50 个散乱的方块（简单）可能比 20 个互相锁死的方块（困难）更容易消除。缺乏对**逻辑深度**的控制。

---

## 2. 核心算法变革：逆向填空生成 (Reverse Filling)

**核心理念**：生成的顺序 = 玩家消除的逆序。

### 算法流程
1.  **初始状态**：一个空的棋盘。
2.  **逆向射入**：
    *   在棋盘边缘随机选择一个位置和反方向（例如：选定上方某点，方向向下）。
    *   发射方块，使其“滑入”棋盘，直到碰到边界或其他方块停止。
    *   **关键点**：这个方块在生成时是“最后”进去的，意味着在游玩时它是“最先”可以被移走的（位于最外层）。
3.  **层层堆叠**：重复上述过程。后射入的方块会挡住先射入的方块，自然形成了 `A挡住B` 的依赖关系。
4.  **结果**：生成的关卡天然 **100% 可解**，且解法逻辑清晰（类似剥洋葱）。

---

## 3. 难度递增策略 (Difficulty Progression)

这是本游戏设计的核心。我们将通过控制**四个维度**的参数，构建一条平滑且富有挑战的难度曲线。

### 维度 A：依赖深度 (Dependency Depth) - *核心逻辑难度*
*   **定义**：解开一个核心方块需要先移走多少层遮挡物。
*   **控制方式**（逆向生成参数）：
    *   **浅层填充 (Easy)**：倾向于在空旷区域射入方块。生成的结构扁平，大部分方块直接裸露。
    *   **深层插入 (Hard)**：倾向于在已有方块的缝隙中“插队”射入。这会制造“一线天”结构，玩家必须先清空外围狭窄通道，才能释放内部方块。

### 维度 B：空间拥挤度 (Spatial Density) - *操作难度*
*   **定义**：方块之间的空隙大小。
*   **策略**：
    *   **松散 (Level 1)**：保留大量的空洞，配合大尺寸方块，极易点击。
    *   **紧凑 (Level 2+)**：空洞率急剧下降。棋盘迅速填满，玩家需要精确点击，且难以通过“空地”来判断解题路径。

### 维度 C：规模 (Scale) - *耐力挑战*
*   **定义**：方块总数量。
*   **策略**：
    *   数量随关卡线性增加，但不是难度的决定性因素，仅作为基线提升。

---

## 4. 阶段性关卡设计 (Level Phases)

为了让玩家迅速体验游戏的核心乐趣与挑战，我们摒弃漫长的教学期，采用 **“一步登天” (Immediate Immersion)** 的策略。

### Phase 1: 极简教学 (Level 1)
*   **目标**：3秒上手，明白“点一下就会飞走”的基本规则。
*   **参数配置**：
    *   **数量**：极少 (约 4-6 个)。
    *   **尺寸**：**超大 (1.5x - 2.0x)**。让玩家一眼看清，且无需精确点击。
    *   **结构**：无遮挡或仅 1 层遮挡。
    *   **视觉**：居中展示，清晰明了。

### Phase 2: 难度陡增 (Level 2) - *The Spike*
*   **目标**：当头一棒。告诉玩家“这不是一个无脑点点点的游戏”。
*   **参数配置**：
    *   **数量/密度**：**填满屏幕 (Full Screen Fill)**。不再设定固定数量，而是根据屏幕可用面积，最大化填充。预计数量可达 **100+**。
    *   **尺寸**：标准尺寸 (1.0x)，或者为了追求更高密度适当微调。
    *   **算法**：立即引入“深层插入”，制造 3-4 层依赖关系。确保没有大片空地，视觉上给人极强的压迫感。
    *   **体验**：玩家必须立即开始观察结构，寻找唯一的突破口。

### Phase 3: 线性爬升 (Level 3 - Infinity)
*   **目标**：无尽的挑战。
*   **参数配置**：
    *   **依赖深度**：随着关卡号增加，核心区（Core Zone）的层数逐渐加深。
    *   **规模**：始终保持“填满屏幕”的高密度，难度提升主要靠**逻辑深度**（更复杂的死锁结构）而非单纯的数量堆叠。
    *   **交织度**：高难度关卡中，方块将更多地“插”入缝隙中，而不是浮在表面。

---

## 5. 开发计划 (Action Plan)

1.  **原型开发**：编写 `ReverseLevelGenerator.js`，实现基础的射线填空逻辑。
2.  **前端适配**：修改 `BlockRenderer` 和 `GameRenderer`，支持 Level 1 的**大尺寸方块渲染**。
3.  **接入游戏**：替换现有的 Worker 逻辑。
4.  **参数调优**：重点调试 Level 1 到 Level 2 的过渡体验。
