# 优化建议列表

基于对现有代码实现（截至 2026-01-12）与 PRD 文档（v1.3）的对比分析，以下是针对游戏玩法的优化建议和存在的差距。

## 一、 核心玩法与关卡设计（高优先级）

### 1. 关卡布局实现 (Level Implementation)
**现状**：
目前 `LevelGenerator.js` 主要采用程序化生成（Procedural Generation），使用 "菱形密排 (Diamond Layout)" 或 "螺旋布局 (Spiral Layout)" 作为生成策略。

**差距**：
PRD 第 15.3 章节明确定义了前 10 关的具体教学布局，旨在循序渐进地教导玩家：
- **Level 1**: 横向排列 (教会"朝向屏幕边界可消除")
- **Level 2**: 2x2 网格 (教会"不同朝向都能消除")
- **Level 3**: L 形排列 (展示"被阻挡不能消除")
- **Level 5**: 十字形
- **Level 10**: 心形布局

**优化建议**：
- 修改 `LevelGenerator.js`，为 Level 1-10 实现**固定布局**（Hardcoded Layouts）。
- 仅对 Level 11+ 使用现有的程序化生成算法。
- 确保前 3 关（教学关）的方块数量和方向严格遵循 PRD 设计，降低新手流失率。

### 2. 动物种类多样性
**现状**：
目前代码主要使用 3 种动物（猪、羊、狗）作为主要显示对象 (`MAIN_ANIMAL_TYPES`)。

**差距**：
PRD 第 13.1 章节列出了 8 种基础动物和 4 种解锁动物。虽然 v1.3 更新聚焦于 3 种核心动物，但为了保持视觉丰富度，建议在后续关卡（如 Level 10+）逐步引入其他已定义在 `UIConstants.js` 中的动物（猫、兔、熊等）。

**优化建议**：
- 在 `LevelGenerator.js` 中增加逻辑，随着关卡等级提升，逐步扩充 `ANIMAL_TYPES` 数组，引入更多动物类型。

## 二、 视觉与 UI 表现

### 1. 进度头像一致性
**现状**：
`GameRenderer.js` 中的 `drawProgress` 方法目前绘制的是一个 **小猴子 (Monkey)** 头像。
`MenuRenderer.js` 中绘制的是 **小熊猫 (Panda)**。

**差距**：
PRD 第 18.2 章节（关卡界面）和 18.1 章节（主页）均指定使用 **小熊猫 (Panda)** 作为核心角色。

**优化建议**：
- 修改 `GameRenderer.js`，将进度条旁的头像统一改为小熊猫，保持与主页角色一致，增强品牌感。

### 2. 默认值一致性
**现状**：
`Block.js` 的构造函数默认 `type` 为 `ANIMAL_TYPES.CAT`。

**优化建议**：
- 建议将默认值修改为 `ANIMAL_TYPES.PIG`（或其他 `MAIN_ANIMAL_TYPES` 之一），以防止在未指定类型的情况下出现意外的"猫"方块，导致视觉风格不统一。

## 三、 功能完善（TODOs）

### 1. 设置功能
**现状**：
UI 上已有设置按钮，但在 `DirectionGame.js` 中点击逻辑仅输出日志 `TODO: 打开设置面板`。

**优化建议**：
- 实现基础的设置面板，至少包含：
  - 音效开关 (SFX On/Off)
  - 音乐开关 (BGM On/Off)
  - 震动反馈开关 (Vibration On/Off)
  - 重玩教程入口

### 2. 更多功能入口
**现状**：
撤销、背景切换、纯色模式等按钮在 UI 上已存在，但部分功能逻辑尚未完全连接。

**优化建议**：
- 确认 `pureColor`（纯色模式）和 `background`（背景切换）的实际逻辑是否已在渲染层实现支持。如果不即时实现，应像"排行榜"一样添加"敬请期待"提示或暂时隐藏。

## 四、 音频资源检查

**建议**：
- 核对 `audio/` 目录下的资源是否覆盖了 PRD 第 14 章定义的所有音效：
  - BGM: Menu, Playing, Victory, Defeat
  - SFX: Button Click, Click Success (Pop), Click Fail (Thud), Slide Out (Whoosh), Prop Use (Magic)
- 确保 `AudioConfig.js` 中正确映射了这些文件路径。

---
**总结**：
当前代码质量较高，核心玩法逻辑（方向消除、道具系统）已完整实现。最核心的优化点在于**前 10 关的关卡设计**需要从随机生成改为精心设计的固定布局，以提升新手体验。
